SAMPLES = ["93E",  "41865",  "50073",  "32947_c7",  "50004",  "5MRLiCTR",  "2GW3iCTR",  "2PFYiCTR",  "6GNGiCTR",  "5JAZiALS",  "2WW0iALS",  "0YJYiALS",  "2NDDiALS",  "0WD8iALS",  "0JCLiALS",  "AG0017",  "50000",  "35658",  "29iALS",  "12240",  "39B",  "3XLKiALS",  "184",  "6769",  "6769_c1",  "3719",  "10739",  "10689",  "13454",  "No4",  "SOD139B_1",  "29iALS_ISO",  "2CLNiALS",  "2DDGiALS",  "ES",  "1B06",  "6GHCiALS",  "SOD139B_2",  "5FFPiALS",  "No3",  "12099",  "5280",  "3231",  "50007",  "OKVBiALS",  "2B09",  "39B_Corr",  "CS5HF7iALS",  "CS2YNLiALS",  "5GR5iALS",  "1RUG",  "12100",  "AH9iALS",  "11813_fibs",  "10739_fibs",  "9292_fibs",  "13454_fibs",  "CS0KHAiALS",  "9711",  "14185",  "ND35663",  "CS0KBHiALS",  "ND09329",  "ND50082",  "BxPC3",  "SH4",  "LNCaP",  "U87",  "786O",  "A375",  "Panc0504",  "Panc1005",  "HCC1806",  "SU8686",  "HCT15",  "HPAC",  "HepG2",  "HPAFII",  "SW1990",  "MDA231",  "PC3",  "SJSA1",  "143B",  "LN229",  "Caki1",  "Panc0203",  "Capan2",  "Panc1",  "Hep3b",  "AGS",  "AsPC1",  "SW620",  "ND08957",  "ND08075"]
SC_SAMPLES = ["8-3", "8-4", "21-2", "21-4", 
                  "60-1", "60-4"]
working_dir = "/home/cachris/geneva/hypoxia/"

rule all:
    input:
        expand(working_dir + "cellranger_outputs/{sc_sample}/possorted_genome_bam.bam", sc_sample = SC_SAMPLES)
       
rule cellranger:
    input:
        data = "/home/cachris/geneva/hypoxia/data/TSHG10_hypoxia_GENEVA",
    output:
        bams = working_dir + "cellranger_outputs/{sc_samples}/possorted_genome_bam.bam"
    params:
        index = "/home/genomes/cellranger_refs/refdata-gex-GRCh38-2020-A/",
        ids = "{sc_samples}",
        outputdir = working_dir + "cellranger_outputs/{sc_samples}"
    threads:
        20
    log:
        working_dir + "logs/cellranger/{sc_samples}.log"
    # Call the cellranger command for each sample
    shell:
        """
        cellranger count \
        --id={params.ids} \
        --fastqs={input.data}\
        --transcriptome={params.index} \
        --sample={params.ids} \
        --localcores={threads} > {log} 2>&1 \
        && mv {params.ids}/outs/* {params.outputdir}/ 
          """